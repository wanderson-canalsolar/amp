jQuery(document).ready(function(){jQuery.datepicker.setDefaults(jQuery.datepicker.regional["en-GB"]),jQuery("#wcal_start_date").datepicker({onSelect:function(t){jQuery("#wcal_end_date").datepicker("option","minDate",t),setTimeout(function(){jQuery("#wcal_end_date").datepicker("show")},16)},maxDate:"0",changeMonth:!0,changeYear:!0,dateFormat:"yy-mm-dd"}),jQuery("#duration_select").change(function(){jQuery("#duration_select").val();"custom"==jQuery(this).val()&&(document.getElementById("wcal_start_end_date_div").style.display="block"),"custom"!=jQuery(this).val()&&(document.getElementById("wcal_start_end_date_div").style.display="none")})}),jQuery(document).ready(function(){jQuery("#wcal_end_date").datepicker({maxDate:"0",changeMonth:!0,changeYear:!0,dateFormat:"yy-mm-dd"})});var margin={top:20,right:40,bottom:80,left:40},width=980-margin.left-margin.right,height=500-margin.top-margin.bottom,x0=d3.scale.ordinal().rangeRoundBands([0,width],.4),x1=d3.scale.ordinal(),y0=d3.scale.linear().range([height,0]),y1=d3.scale.linear().range([height,0]),color=d3.scale.ordinal().range(["#98abc5","#d0743c"]),xAxis=d3.svg.axis().scale(x0).orient("bottom").ticks(5),yAxisLeft=d3.svg.axis().scale(y0).orient("left").tickFormat(function(t){return parseInt(t)}),yAxisRight=d3.svg.axis().scale(y1).orient("right").tickFormat(function(t){return parseInt(t)}),svg=d3.select(".chartgraph").append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")"),data=wcal_graph_data.data;console.log(data);var dataset=[],keyNames=["abandoned_amount","recovered_amount"];for(i=0;i<Object.keys(data).length;i++){var date=Object.keys(data)[i];dataset[i]={date:date,values:[{name:"Abandoned Revenue",value:data[date][keyNames[0]]},{name:"Recovered Revenue",value:data[date][keyNames[1]]}]}}x0.domain(dataset.map(function(t){return t.date})),x1.domain(["Abandoned Revenue","Recovered Revenue"]).rangeRoundBands([0,x0.rangeBand()]),y0.domain([0,d3.max(dataset,function(t){return t.values[0].value})]),y1.domain([0,d3.max(dataset,function(t){return t.values[1].value})]),svg.append("g").attr("class","x axis").attr("transform","translate(0,"+height+")").call(xAxis).selectAll("text").attr("y",0).attr("x",9).attr("dy",".35em").attr("transform","rotate(45)").style("text-anchor","start"),svg.append("g").attr("class","y0 axis").call(yAxisLeft).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").style("fill","#98abc5").text("Abandoned Revenue"),svg.select(".y0.axis").selectAll(".tick").style("fill","#98abc5").append("text"),svg.append("g").attr("class","y1 axis").attr("transform","translate("+width+",0)").call(yAxisRight).append("text").attr("transform","rotate(-90)").attr("y",-16).attr("dy",".71em").style("text-anchor","end").style("fill","#d0743c").text("Recovered Revenue"),svg.select(".y1.axis").selectAll(".tick").style("fill","#d0743c");var graph=svg.selectAll(".date").data(dataset).enter().append("g").attr("class","g").attr("transform",function(t){return"translate("+x0(t.date)+",0)"});graph.selectAll("rect").data(function(t){return t.values}).enter().append("rect").attr("width",x1.rangeBand()).attr("x",function(t){return x1(t.name)}).attr("y",function(t){return y0(t.value)}).attr("height",function(t){return height-y0(t.value)}).style("fill",function(t){return color(t.name)}),graph.selectAll("rect").on("mouseover",function(t){var e=t.value,a=d3.select(this.parentNode).attr("transform");a=(a=a.replace("translate(","")).replace(",0)","");var r=parseFloat(a)+parseFloat(d3.select(this).attr("x")),n=parseFloat(d3.select(this).attr("y")),d=parseFloat(d3.select(this).attr("height"));d3.select(this).attr("stroke","blue").attr("stroke-width",.8),svg.append("text").attr("x",r).attr("y",n+d/2).attr("class","graph-tooltip").text(t.name+": "+e)}).on("mouseout",function(){svg.select(".graph-tooltip").remove(),d3.select(this).attr("stroke","pink").attr("stroke-width",.2)});var legend=svg.selectAll(".legend").data(["Abandoned Revenue","Recovered Revenue"].slice()).enter().append("g").attr("class","legend").attr("transform",function(t,e){return"translate(0,"+20*e+")"});legend.append("rect").attr("x",width-48).attr("width",18).attr("height",18).style("fill",color),legend.append("text").attr("x",width-54).attr("y",9).attr("dy",".35em").style("text-anchor","end").text(function(t){return t});